<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JESC CUP - Risultati</title>
  <style>
    body { font-family: Arial, sans-serif; background: #222; color: #eee; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; text-align: center; border-bottom: 1px solid #444; }
    tbody td:nth-child(2) { text-align: left; }
    .flag-icon { width: 24px; margin-right: 8px; vertical-align: middle; }
    .video-container { max-width: 600px; margin: 20px auto; position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; }
    .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
  </style>
</head>
<body>

  <h1>JESC CUP - Risultati <span id="year-title"></span></h1>

  <table>
    <thead>
      <tr>
        <th>Posizione</th>
        <th>Paese</th>
        <th>Voto</th>
        <th>Voce</th>
        <th>Coreografia</th>
        <th>Totale</th>
      </tr>
    </thead>
    <tbody id="results"></tbody>
  </table>

  <div id="top-videos">
    <div id="video1" class="video-container"></div>
    <div id="video2" class="video-container"></div>
    <div id="video3" class="video-container"></div>
  </div>

  <script>
    // Prende l'anno dal nome file es. 2004.html
    const year = window.location.pathname.match(/(\d{4})\.html$/)?.[1] || '2003';
    document.getElementById('year-title').textContent = year;

    fetch(`data-${year}.json`)
      .then(res => res.json())
      .then(data => {
        const results = document.getElementById('results');
        const videoContainers = ['video1', 'video2', 'video3'];
        results.innerHTML = '';

        // Ordina per totale
        const sorted = [...data].sort((a,b) => ((b.voto*10)*b.voce*b.coreografia) - ((a.voto*10)*a.voce*a.coreografia));

        sorted.forEach((item, i) => {
          const tr = document.createElement('tr');

          tr.innerHTML = `
            <td>${i+1}Â°</td>
            <td><img src="flags/${item.code}.png" alt="${item.paese} flag" class="flag-icon">${item.paese}</td>
            <td>${item.voto.toFixed(1)}</td>
            <td>${item.voce.toFixed(1)}</td>
            <td>${item.coreografia.toFixed(1)}</td>
            <td>${((item.voto*10)*item.voce*item.coreografia).toFixed(2)}</td>
          `;

          results.appendChild(tr);

          // Video top 3
          if (i < 3 && item.video) {
            const iframe = document.createElement('iframe');
            iframe.src = item.video.replace('watch?v=', 'embed/');
            iframe.frameBorder = '0';
            iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
            iframe.allowFullscreen = true;
            document.getElementById(videoContainers[i]).appendChild(iframe);
          }
        });
      })
      .catch(err => console.error('Errore caricamento dati:', err));
  </script>

</body>
</html>
